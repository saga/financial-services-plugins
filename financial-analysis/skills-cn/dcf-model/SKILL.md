---
name: dcf-model-cn
description: 用于股权估值的真实 DCF（现金流量折现）模型创建。从 SEC 申报文件和分析师报告中提取财务数据，构建包含完整 WACC 计算的现金流预测，执行敏感性分析，并输出包含执行摘要的专业 Excel 模型。当用户需要使用 DCF 方法进行公司估值、请求内在价值分析，或要求进行包含增长预测和终值计算的详细财务建模时使用。
---

# DCF 模型构建指南

## 概述

本技能按照投资银行标准创建机构级的 DCF 估值模型。每次分析都会生成一个详细的 Excel 模型（DCF 工作表底部包含敏感性分析表）。

## 核心约束——请先阅读

以下约束适用于所有 DCF 模型构建过程：

**敏感性分析表：**
- 填充全部 75 个单元格（3 张表 × 25 个单元格），必须包含完整的 DCF 重新计算公式。
- 使用 openpyxl 循环程序化地写入公式。
- **禁止** 使用占位符文本、**禁止** 使用线性近似、**禁止** 需要手动操作的步骤。
- 每个单元格必须针对该假设组合重新计算完整的 DCF 结果。

**单元格批注：**
- 在创建每个硬编码值（蓝色字体）时，**立即** 添加单元格批注。
- 格式："来源：[系统/文档], [日期], [参考页码], [URL（如有）]"。
- 在进入下一节前，每个蓝色输入项必须已有批注。不要推迟到最后或写 "TODO"。

**模型布局规划：**
- 在编写任何公式之前，先定义所有部分的行位置。
- 第一步：写下所有标题和标签。
- 第二步：画出所有分节线和空白行。
- 第三步：利用锁定的行位置编写公式。

**公式重算验证：**
- 交付前运行 `python recalc.py model.xlsx 30`。
- 修复所有错误，直到状态显示为 "success"。不允许存在任何 #REF!、#DIV/0!、#VALUE! 等错误。

**情景分析块：**
- 为悲观 (Bear)、基础 (Base)、乐观 (Bull) 情景创建独立的数据块。
- 在每个块内，按预测年份横向展示假设。
- 使用 INDEX 公式：`=INDEX([情景范围], 1, $B$6)`（$B$6 为情景选择器）。

## DCF 执行流程

### 第一步：数据检索与验证
**优先级：** MCP 服务器数据 > 用户提供数据 > 网页搜索。
**验证清单：** 净债务/现金位置、稀释后总股数、历史利润率合理性、所得税率（通常 21-28%）。

### 第二步：历史分析（3-5 年）
分析营收增长趋势（CAGR）、利润率演变（毛利、EBIT、FCF）、资本密集度（D&A 和 CapEx 占营收比）以及营运资本效率。

### 第三步：营收预测
- **方法：** 从最新实际数据开始，按年份应用增长率。
- **框架：** 第 1-2 年高增长（近景），第 3-4 年向行业均值平滑过渡，第 5 年起接近永续增长率。

### 第四步：运营费用建模
- **原则：** 所有百分比基于**营业收入**（而非毛利润）。
- **逻辑：** 体现运营杠杆（OpEx 占比随规模扩大而下降）。分别建模销售、研发和管理费用。

### 第五步：自由现金流 (FCF) 计算
```
EBIT
(-) 所得税 (EBIT × 税率)
= NOPAT (税后净营业利润)
(+) 折旧与摊销 (D&A，非现金支出)
(-) 资本开支 (CapEx)
(-) 营运资本变动 (Δ NWC)
= 无杠杆自由现金流 (Unlevered FCF)
```

### 第六步：资本成本 (WACC) 研究
- **股权成本：** 无风险利率 + Beta × 股权风险溢价 (ERP)。
- **债务成本：** 税后债务成本 = 税前债务成本 × (1 - 税率)。
- **权重：** 使用权益和债务的**市值**权重（Market Value Weights）。

### 第七步：折现率应用
- **年中惯例 (Mid-Year Convention)：** 假设现金流发生在年中。折现期间：0.5, 1.5, 2.5...
- **折现因子：** 1 / (1 + WACC)^期间。

### 第八步：终值 (Terminal Value) 计算
- **永续增长法（首选）：** TV = [最后一年 FCF × (1 + g)] / (WACC - g)。
- **g 选择：** 保守 2.0-2.5%（GDP 增速），通常不超过无风险利率。
- **合理性检查：** 终值通常应占企业价值 (EV) 的 50-70%。

### 第九步：企业价值向权益价值转换
```
(+) 预测期 FCF 现值之和
(+) 终值现值
= 企业价值 (Enterprise Value)
(-) 净债务 [或 + 净现金]
= 权益价值 (Equity Value)
(÷) 稀释后总股数
= 每股内在价值
```

### 第十步：敏感性分析
在 DCF 工作表底部构建三张 5×5 的敏感性表：
1. **WACC vs. 永续增长率** (对估值影响最大)
2. **营收增长率 vs. EBIT 利润率** (反映运营表现)
3. **Beta vs. 无风险利率** (反映资本成本敏感度)

---

## 视觉与格式标准

- **字体颜色（强制）：**
  - **蓝色：** 所有硬编码输入（数据、假设）。
  - **黑色：** 所有公式和计算。
  - **绿色：** 跨表链接（例如引用自 WACC 工作表）。
- **数字格式：**
  - 百分比：`0.0%`
  - 金额：`$#,##0` (百万元)；`$#,##0.00` (每股)
  - 零值：显示为 "—"
  - 负数：放在括号内 `(#,##0)`
- **边框：** 必须在主要章节周围使用专业边框。没有边框的模型不符合交付标准。

## 交付物
文件命名：`[Ticker]_DCF_Model_[日期].xlsx`
包含两个工作表：
1. **DCF**：包含三情景假设、现金流构建、估值汇总及底部的敏感性表。
2. **WACC**：包含权益成本、债务成本及资本结构计算。
